---
format_version: '3'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: android
trigger_map:
- push_branch: master
  workflow: master
- push_branch: bug/*
  workflow: feature
- pull_request_source_branch: feature/*
  workflow: masterPR
  pull_request_target_branch: master
- pull_request_source_branch: task/*
  pull_request_target_branch: master
  workflow: masterPR
- pull_request_source_branch: bug/*
  pull_request_target_branch: master
  workflow: masterPR
workflows:
  feature:
    steps:
    - activate-ssh-key@3.1.1:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@3.5.0: {}
    - gradle-unit-test@1.0.2:
        title: Unit Test
        inputs:
        - unit_test_flags: "--continue --no-rebuild --full-stacktrace --daemon --parallel
            --profile"
    - gradle-runner@1.7.1:
        inputs:
        - gradle_file: "$GRADLE_BUILD_FILE_PATH"
        - gradle_task: assembleProductionRelease
        - gradlew_path: "$GRADLEW_PATH"
        - gradle_options: "--full-stacktrace --daemon --parallel --profile"
        title: Assemble
  master:
    steps:
    - activate-ssh-key@3.1.1:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@3.5.0: {}
    - gradle-unit-test@1.0.2:
        title: Unit Test
        inputs:
        - unit_test_flags: "--continue --no-rebuild --full-stacktrace --daemon --parallel
            --profile"
    - gradle-runner@1.7.1:
        inputs:
        - gradle_file: "$GRADLE_BUILD_FILE_PATH"
        - gradle_task: assembleProductionRelease
        - gradlew_path: "$GRADLEW_PATH"
        - gradle_options: "--full-stacktrace --daemon --parallel --profile"
        title: Assemble
    - sign-apk@1.2.0: {}
    - hockeyapp-deploy-android@1.1.1:
        inputs:
        - apk_path: "$BITRISE_SIGNED_APK_PATH"
        - mapping_path: app/build/outputs/mapping/production/release/mapping.txt
        - api_token: "$HOCKEY_APP_TOKEN_DEBUG"
        - app_id: "$HockeyAppAppIdDev"
        - notify: '1'
        - repository_url: "$GIT_REPOSITORY_URL"
        title: Release
  masterPR:
    steps:
    - activate-ssh-key@3.1.1:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@3.5.0: {}
    - gradle-unit-test@1.0.2:
        title: Unit Test
        inputs:
        - unit_test_flags: "--continue --no-rebuild --full-stacktrace --daemon --parallel
            --profile"
    - gradle-runner@1.7.1:
        inputs:
        - gradle_file: "$GRADLE_BUILD_FILE_PATH"
        - gradle_task: assembleProductionRelease
        - gradlew_path: "$GRADLEW_PATH"
        - gradle_options: "--full-stacktrace --daemon --parallel --profile"
        title: Assemble
  monkey:
    steps:
    - activate-ssh-key@3.1.1:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@3.5.0: {}
    - create-android-emulator@1.1.5:
        inputs:
        - platform: android-22
        - name: "$BITRISE_EMULATOR"
    - start-android-emulator@1.3.1:
        inputs:
        - emulator_name: "$BITRISE_EMULATOR"
        - emulator_options: "-no-boot-anim"
        - skin: 480x800
    - gradle-runner@1.7.1:
        inputs:
        - gradle_file: "$GRADLE_BUILD_FILE_PATH"
        - gradle_task: assembleProductionRelease
        - gradlew_path: "$GRADLEW_PATH"
        - gradle_options: "--full-stacktrace --daemon --parallel --profile"
        title: Assemble
    - script@1.1.4:
        inputs:
        - content: |-
            #!/bin/bash
            # fail if any commands fails
            set -e
            # debug log
            set -x

            # write your script here
            echo "Start MonkeyRunner"
            monkeyrunner $MONKEYRUNNER_SCRIPT

            # or run a script from your repository, like:
            # bash ./path/to/script.sh
            # not just bash, e.g.:
            # ruby ./path/to/script.rb
    - script@1.1.4:
        inputs:
        - content: |-
            #!/bin/bash
            # fail if any commands fails
            set -e
            # debug log
            set -x

            # write your script here
            echo "Hello World!"
            adb shell monkey --throttle 10 -p co.netguru.android.socialslack -v 10000

            # or run a script from your repository, like:
            # bash ./path/to/script.sh
            # not just bash, e.g.:
            # ruby ./path/to/script.rb
app:
  envs:
  - opts:
      is_expand: false
    GRADLEW_PATH: "./gradlew"
  - opts:
      is_expand: false
    GRADLE_BUILD_FILE_PATH: build.gradle
  - FABRIC_API_KEY: 85a72fdb988dc31701dbbe93124c0dbebe503133
  - BITRISE_EMULATOR: emulator
  - MONKEYRUNNER_SCRIPT: monkeyrunner_login.py
